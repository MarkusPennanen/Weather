<!doctype html>
<html class="no-js" lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="weather.css">
</head>

<body onload="defaultWeather()">
<div id="appDiv">
<div>
<h1>Weather</h1>
<h2>Search for a city</h2>

  </div>
  <input id="searchInpt" onclick="hideError()"></input><button id="searchBtn" onclick="getWeather()">Search</button>
  <h3 id = "errortxt">City not found</h3>
  <div id="wDisplay">
  </div>
</div>


<script>
document.getElementById("errortxt").style.display = "none";
function hideError() {
  document.getElementById("errortxt").style.display = "none";
}
function defaultWeather() {
  var url = "https://api.openweathermap.org/data/2.5/weather?q=helsinki&units=metric&mode=JSON&APPID=c706afc24bc0b96f37199fe59e85d093";
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.open("GET",url, true);
  xmlhttp.send();
  xmlhttp.onreadystatechange = function() {
    var fullResponse;
    if (xmlhttp.readyState==4 && xmlhttp.status==200){
      var jsonObj = JSON.parse(xmlhttp.responseText);
      var weatherInput = "";
      var iconUrl = "http://openweathermap.org/img/w/"+jsonObj.weather[0].icon+".png";
      weatherInput += "<h4>"+jsonObj.name+"</h4>"
      weatherInput += "<h4>"+jsonObj.main.temp+ "°C" + "</h4>"
      weatherInput += "<h5>"+jsonObj.weather[0].description+"</h5>"
      weatherInput += "<h5>"+jsonObj.main.temp_max+"°C / " + jsonObj.main.temp_min + "°C" + "</h5>"
      weatherInput += "<h5>Humidity  "+jsonObj.main.humidity+"</h5>"
      weatherInput += "<h6><img src="+iconUrl+"></h6>";
      document.getElementById("wDisplay").innerHTML = weatherInput;
    }
  }
}
function getWeather() {
  var citySelect = document.getElementById("searchInpt").value;
  var newcitySelect = "";
  for(var i = 0; i<citySelect.length; i++) {
    if (citySelect[i] == 'ä') {
      newcitySelect += 'a';
    }
    else if (citySelect[i] == 'ö') {
      newcitySelect += 'o';
    }
    else if (citySelect[i] || 'ä' && citySelect[i] || 'ö'){
      newcitySelect += citySelect[i];
    }
  }
  console.log(newcitySelect);
  var url = "https://api.openweathermap.org/data/2.5/weather?q="+newcitySelect+"&units=metric&mode=JSON&APPID=c706afc24bc0b96f37199fe59e85d093";
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.open("GET",url, true);
  xmlhttp.send();
  xmlhttp.onreadystatechange = function() {
    var fullResponse;
    if (xmlhttp.readyState==4 && xmlhttp.status==200){
      var jsonObj = JSON.parse(xmlhttp.responseText);
      var weatherInput = "";
      var iconUrl = "http://openweathermap.org/img/w/"+jsonObj.weather[0].icon+".png";
      weatherInput += "<h4>"+jsonObj.name+"</h4>"
      weatherInput += "<h4>"+jsonObj.main.temp+ "°C" + "</h4>"
      weatherInput += "<h5>"+jsonObj.weather[0].description+"</h5>"
      weatherInput += "<h5>"+jsonObj.main.temp_max+"°C / " + jsonObj.main.temp_min + "°C" + "</h5>"
      weatherInput += "<h5>Humidity  "+jsonObj.main.humidity+"</h5>"
      weatherInput += "<h6><img src="+iconUrl+"></h6>";
      document.getElementById("wDisplay").innerHTML = weatherInput;
      document.getElementById("errortxt").style.display = "none";
    } else {
      document.getElementById("errortxt").style.display = "block"
    }
  }
}
</script>
</body>
</html>
